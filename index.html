<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Pipeline MIPS</title>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js">
  </script>

  <link rel="stylesheet" type="text/css" href="styles.css">
  <link rel="shortcut icon" type="image/x-icon" href="favicon.ico">
</head>
<body>
  <svg xmlns:html="http://www.w3.org/1999/xhtml"
          viewBox="0 0 1300 600"
          id="canvas" width="1300" height="600">
    <!--
      viewBox eh o tamanho logico do canvas. Se voce nao mexer nele,
      da p/ alterar width e height a vontade que nao precisa alterar
      as coordenadas no codigo abaixo
    -->

    <!--
      RESUMO <path>
      maiusculo:  posicao absoluta
      minusculo: distancia
      X cresce p/ esquerda
      Y cresce p/ baixo

      O caminho eh uma sequencia dessas diretivas:

      M x y: posiciona a caneta em x,y sem desenhar
      m dx dy: anda a caneta uma distancia dx,dy sem desenhar

      H x: risca horizontalmente ate a posicao x
      h dx: risca horizontalmente uma distancia dx

      V y: risca verticalmente ate a posicao y
      v dy: risca verticalmente uma distancia dy

      L x y: risca ate a posicao x,y
      l dx dy: risca uma distancia dx,dy
    -->

    <!-- A aparencia dos elementos ta definida no CSS -->

    <!-- ADD PC -->
    <g class="text-box" transform="translate(165, 325) scale(0.75)">
		<polygon points="-25,-50 -25,50 25,25, 25,-25"/>
		<text x="-10" y="5">
			<tspan> ADD </tspan>
		</text>
    </g>
	
	<!--memoria instrução-->
	<g class="text-box" transform="translate(120, 400)">
		<rect x="0" y="0" width="75" height="75"/>
		<text x="17" y="35">
			<tspan> INSTR. </tspan>
			<tspan x="25" dy="1.2em"> MEM </tspan>
		</text>
	</g>

	<path id="PC_IFID" d="M 195 435 v 0 h 25 v 0"></path>	

	<!--Bloco do PC-->
	<g class="text-box" transform="translate(50, 300)">
 		<rect x="0" y="0" width="30" height="75"/>
		<text x="7" y="40">
			<tspan> PC </tspan>
		</text>
	</g>

	<path id="PC_MEMINST" d="M 90 335 v 100 h 30 v 0"></path>

	<!-- somador 4 -->
	<text x="110" y="315">
		<tspan> 4 </tspan>
	</text>

	<path id="PC_ADDPC" d="M 80 335 v 0 h 65 v 0"></path>
	<path id="INC_4" d="M 120 310 v 0 h 25 v 0"></path>	

	<path id="ADDPC_IDIF" d="M 184 325 h 10 v -60 h 30"></path>
	<path id="ADDPC_MUX" d="M 193 265 h -20 v -165 h -65 v 45"></path>

	<!--mux-->
	<g class="text-box" transform="translate(50, 145)">
		<rect x="0" y="0" width="75" height="30"/>
		<text x="25" y="20">
			<tspan> MUX </tspan>
		</text>
	</g>

	<path id="MUX_PC" d="M 85 176 v 50 h -50 v 110 h 15"></path>	

	<!--=======INICIO BLOCO IF/ID============-->
    <g class="text-box" transform="translate(250, 250)">
      <!-- Desenha um trapezio centrado nas coordenadas do translate(x, y) -->
      <!-- Pra reposicionar, so precisa alterar os parametros do translate -->
      <rect x="-30" y="0" width="60" height="300"/>
		<text text-anchor="middle" class="text-variables" x="0" y="25">
			<tspan x="0" dy="1.2em">NewPC</tspan>
			<tspan x="0" dy="1.5em">10</tspan>
		</text>
		<g transform="translate(25, 150) rotate(90)">
			<rect x="0" y="10" width="130" height="30"/>
			<text x="10" y="30">
				<tspan id="IfIdInst"> ADD $R2 $R0 $R1 </tspan>
			</text>
		</g>
	  <text text-anchor="middle" x="0" y="295">
		  <tspan> IF/ID </tspan>
	  </text>
    </g>

	<path id="IFID_IDEX" d="M 281 265 h 250"></path>

	<path id="IFID_OUT" d="M 281 450 h 25"></path>	

	<path id="IFID_OUT_REGa" d="M 306 450 h 5 v -40 h 40"></path>

	<path id="IFID_OUT_REGb" d="M 311 410 v -40 h 40"></path>

	<!--banco de registradores-->
	<g class="text-box" transform="translate(350, 350)">
		<rect x="0" y="0" width="75" height="100"/>
		<text x="25" y="55">
			<tspan> REGs </tspan>
		</text>
	</g>

	<path id="REGSa_IDEX" d="M 425 375 h 100"></path>
	<path id="REGSb_IDEX" d="M 425 425 h 100"></path>

	<!-- Extensor de sinal -->
	<g class="text-box" transform="translate(350, 465)">
		<rect x="0" y="0" width="65" height="65"/>
		<text x="18" y="30">
			<tspan> Sign </tspan>
			<tspan x="10" dy="1.2em"> extend </tspan>
		</text>
	</g>

	<path id="IFID_OUT_SIGEXT" d="M 311 450 v 50 h 40"></path>

	<path id="SIGEXT_IDEX" d="M 415 500 h 110"></path>

	<path id="IFID_OUT_RT" d="M 311 500 v 35 h 210"></path>

	<path id="IFID_OUT_RD" d="M 311 535 v 10 h 210"></path>
	
	<!--=======FIM BLOCO IF/ID============-->

	<!--=======INICIO BLOCO ID/EX============-->
	<g class="text-box" transform="translate(550, 250)">
      <rect x="-30" y="0" width="60" height="300"/>
		<text text-anchor="middle" class="text-variables" x="0" y="25">
			<tspan x="0" dy="1.2em">NewPC</tspan>
			<tspan x="0" dy="1.5em">10</tspan>
		</text>
		<g transform="translate(25, 150) rotate(90)">
			<rect x="0" y="10" width="130" height="30"/>
			<text x="10" y="30">
				<tspan id="IfIdInst"> ADD $R2 $R0 $R1 </tspan>
			</text>
		</g>
	  <text text-anchor="middle" x="0" y="295">
		  <tspan> ID/EX </tspan>
	  </text>
    </g>

	<!--==INICIO ELEMENTOS E LIGAÇÕES DO BLOCO ID/EX==-->

	<!--ADD BRENCH -->
	<g class="text-box" transform="translate(750, 290) scale(0.75)">
		<polygon points="-25,-50 -25,50 25,25, 25,-25"/>
		<text x="-10" y="5">
			<tspan> ADD </tspan>
		</text>
    </g>

	<path id="IDEX_EXMEM" d="M 600 405 v 55 h 219"></path>

	<path id="IDEX_ADD" d="M 580 265 h 150"></path>

	<path id="IDEX_SHIFT" d="M 580 480 h 50 v -125"></path>

	<path id="SHIFT_ADD" d="M 660 320 h 70"></path>

	<path id="ADD_EXMEM" d="M 770 290 h 50"></path>
	
	<!-- ULA -->
	<g class="text-box" transform="translate(750, 390) scale(0.75)">
		<polygon points="-25,-50 -25,50 25,25, 25,-25"/>
		<text x="-10" y="5">
			<tspan> ALU </tspan>
		</text>
    </g>

	<path id="IDEX_ULA" d="M 580 370 h 150"></path>

	<path id="IDEX_MUX" d="M 580 405 h 100"></path>

	<path id="MUX_ULA" d="M 705 415 h 25"></path>

	<path id="IDEX_MUX2" d="M 630 440 h 50"></path>
	
	<path id="IDEX_MUXRT" d="M 580 520 h 100"></path>
	
	<path id="IDEX_MUXRD" d="M 580 540 h 100"></path>

	<path id="MUX_EXMEM" d="M 705 530 h 115"></path>

	<path id="ULA_EXMEM" d="M 770 390 h 50"></path>

	<!-- MUX ULA -->
	<g class="text-box" transform="translate(675, 390)">
		<rect x="0" y="0" width="30" height="65"/>
		<text x="5" y="35">
			<tspan> MUX </tspan>
		</text>
	</g>

	<!-- MUX RT RD-->
	<g class="text-box" transform="translate(675, 500)">
		<rect x="0" y="0" width="30" height="65"/>
		<text x="5" y="35">
			<tspan> MUX </tspan>
		</text>
	</g>

	<!-- Shift Left 2 -->
	<g class="text-box" transform="translate(610, 290)">
		<rect x="0" y="0" width="50" height="65"/>
		<text x="6" y="30">
			<tspan> Shift </tspan>
			<tspan x="4" dy="1.2em"> Left 2 </tspan>
		</text>
	</g>

	<!--=======FIM BLOCO ID/EX============-->

	<!--=======INICIO BLOCO EX/MEM============-->
	<g class="text-box" transform="translate(850, 250)">
      <rect x="-30" y="0" width="60" height="300"/>
		<text text-anchor="middle" class="text-variables" x="0" y="25">
			<tspan x="0" dy="1.2em">AluOut</tspan>
			<tspan x="0" dy="1.5em">10</tspan>
		</text>
		<g transform="translate(25, 150) rotate(90)">
			<rect x="0" y="10" width="130" height="30"/>
			<text x="10" y="30">
				<tspan id="IfIdInst"> ADD $R2 $R0 $R1 </tspan>
			</text>
		</g>
	  <text text-anchor="middle" x="0" y="295">
		  <tspan> EX/MEM </tspan>
	  </text>
    </g>

	<!--==INICIO ELEMENTOS E LIGAÇÕES DO BLOCO EX/MEM==-->
	<path id="MUX_EXMEM" d="M 880 530 h 240"></path>

	<path id="EXMEM_DMEMa" d="M 880 390 h 70"></path>

	<path id="EXMEM_MEMWBa" d="M 910 390 v 100 h 210"></path>

	<path id="EXMEM_DMEMb" d="M 880 460 h 70"></path>

	<!--data memory-->
	<g class="text-box" transform="translate(950, 370)">
		<rect x="0" y="0" width="75" height="100"/>
		<text x="22" y="45">
			<tspan> Data </tspan>
			<tspan x="22" dy="1.2em"> Mem </tspan>
		</text>
	</g>

	<path id="DMEM_MEMWB" d="M 1025 390 h 95"></path>

	<path id="EXMEN_MUX" d="M 880 265 h 50 v -200 h -860 v 80"></path>

	<!--=======FIM BLOCO EX/MEM============-->

	<!--=======INICIO BLOCO MEM/WB============-->
	<g class="text-box" transform="translate(1150, 250)">
      <rect x="-30" y="0" width="60" height="300"/>
		<text text-anchor="middle" class="text-variables" x="0" y="25">
			<tspan x="0" dy="1.2em">AluOut</tspan>
			<tspan x="0" dy="1.5em">10</tspan>
		</text>
		<g transform="translate(25, 150) rotate(90)">
			<rect x="0" y="10" width="130" height="30"/>
			<text x="10" y="30">
				<tspan id="IfIdInst"> ADD $R2 $R0 $R1 </tspan>
			</text>
		</g>
	  <text text-anchor="middle" x="0" y="295">
		  <tspan> MEM/WB </tspan>
	  </text>
    </g>

	<!--==INICIO ELEMENTOS E LIGAÇÕES DO BLOCO MEM/WB==-->
	<path id="MEMWB_MUXa" d="M 1180 390 h 40"></path>

	<path id="MEMWB_MUXb" d="M 1180 490 h 20 v -65 h 20"></path>

	<!-- MUX -->
	<g class="text-box" transform="translate(1220, 370)">
		<rect x="0" y="0" width="30" height="65"/>
		<text x="5" y="35">
			<tspan> MUX </tspan>
		</text>
	</g>

	<path id="MUX_REGS" d="M 1250 400h 30 v 190 h -940 v -150 h 10"></path>

	<path id="MEMWB_REGS" d="M 1180 530 h 20 v 40 h -880 v -140 h 30"></path>

	<!--=======FIM BLOCO MEM/WB============-->

    <!-- Retangulos p/ fazer as memorias e o banco de registradores -->
    <!--<rect x="100" y="100" width="100" height="100"/>
    <rect x="400" y="200" width="100" height="100"/>
    <rect x="350" y="400" width="100" height="100"/>-->

    <!--<path id="caminhoRed"  d="M 200 150 h 50 v 100 h 150"></path>
    <path id="caminhoBlue" d="M 450 300 v 40 h -50 v 60"></path>-->

    <!--
      fill=freeze faz os circulos ficarem parados no fim do caminho quando
      a animacao acaba. Se tirar, eles teleportam para 0,0
    -->

    <!--<circle id="circleRed" fill="red">
      <animateMotion id="animRed" dur="2s" fill="freeze" begin="indefinite">
        <mpath xlink:href="#caminhoRed"/>
      </animateMotion>
    </circle>

    <circle id="circleBlue" fill="blue">
      <animateMotion id="animBlue" dur="2s" fill="freeze" begin="indefinite">
        <mpath xlink:href="#caminhoBlue"/>
      </animateMotion>
    </circle>-->

    <!-- Caixa de texto (p/ instrucoes, memoria etc) -->
    <!--<g class="text-box" transform="translate(600, 100)">
      <rect x="0" y="0" width="120" height="200"/>
      <rect class="selection" x="0" y="0em" width="120" height="1.2em"/>
      <text x="0" y="0">
        <tspan x="0" dy="1.2em"> LW $R0 0 </tspan>
        <tspan x="0" dy="1.2em"> LW $R1 4 </tspan>
        <tspan x="0" dy="1.2em"> NOOP </tspan>
        <tspan x="0" dy="1.2em"> NOOP </tspan>
        <tspan x="0" dy="1.2em"> ADD $R2 $R0 $R1 </tspan>
      </text>
    </g>-->

  </svg>

  <div class="centered">
    <input type="button" id="animateBtn" value="Animar">
    <input type="button" id="advanceBtn" value="Avançar instrução">
  </div>

  <script src="instruction.js"></script>
  <script src="cpu.js"></script>
  <script src="animation.js"></script>
</body>
</html>
